<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitter Video Embed Fixer</title>
    
    <!-- This script handles the redirection for generated links. -->
    <!-- It must run as early as possible for social media crawlers. -->
    <script>
        (() => {
            const urlParams = new URLSearchParams(window.location.search);
            const tweetUrl = urlParams.get('tweet');

            if (tweetUrl) {
                const twitterRegex = /^(https?:\/\/)(www\.)?(twitter\.com|x\.com)(\/.+)/;
                if (twitterRegex.test(tweetUrl)) {
                    // This is the destination URL that has perfect embeds.
                    const embedUrl = tweetUrl.replace(twitterRegex, '$1vxtwitter.com$4');
                    
                    document.title = "Redirecting...";

                    // For bots/crawlers and as a primary redirect method:
                    const meta = document.createElement('meta');
                    meta.setAttribute('http-equiv', 'refresh');
                    meta.setAttribute('content', `0; url=${embedUrl}`);
                    document.head.appendChild(meta);

                    // For modern browsers as a faster, history-less redirect:
                    window.location.replace(embedUrl);
                }
            }
        })();
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        #output-section {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        /* Style for the redirecting page */
        .redirect-page {
            display: none; /* Hidden by default, shown by script if needed */
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <!-- This is the main UI for generating links -->
    <div id="generator-ui" class="w-full max-w-2xl mx-auto">
        <div class="bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-6 md:p-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-4xl font-bold text-white">Fix Twitter Video Embeds</h1>
                <p class="text-gray-400 mt-2">Create a link that generates a rich, playable video embed for Discord.</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label for="twitter-link" class="sr-only">Twitter Link</label>
                    <div class="flex flex-col sm:flex-row gap-3">
                        <input type="text" id="twitter-link" placeholder="e.g., https://x.com/user/status/123..." class="w-full px-4 py-3 bg-gray-900 text-white border border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition duration-200">
                        <button id="generate-btn" class="flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition duration-200 shadow-md whitespace-nowrap">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.72"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.72-1.72"></path></svg>
                            Generate Link
                        </button>
                    </div>
                </div>
            </div>
            <div id="output-section" class="mt-8 opacity-0 transform -translate-y-2 hidden">
                <div class="border-t border-gray-700 pt-6">
                    <p id="error-message" class="text-center text-red-400 mb-4 hidden"></p>
                    <div id="success-output">
                        <label for="output-link" class="block text-sm font-medium text-gray-300 mb-2">Your embeddable link:</label>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <input type="text" id="output-link" readonly class="w-full px-4 py-3 bg-gray-700 text-gray-100 border border-gray-600 rounded-lg cursor-text">
                            <button id="copy-btn" class="flex items-center justify-center gap-2 bg-green-600 hover:bg-green-700 text-white font-semibold px-6 py-3 rounded-lg transition duration-200 shadow-md whitespace-nowrap">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
                                <span id="copy-btn-text">Copy</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
             <div class="text-center mt-8 text-xs text-gray-500">
                <p>This tool generates a link on this domain that redirects to a properly formatted video embed, making it work on platforms like Discord. Not affiliated with X Corp.</p>
            </div>
        </div>
    </div>

    <!-- This is the fallback UI for the redirect page that human users will briefly see -->
    <div id="redirect-ui" class="redirect-page w-full max-w-2xl mx-auto text-center">
         <div class="bg-gray-800 border border-gray-700 rounded-2xl shadow-2xl p-8">
            <h1 class="text-2xl font-bold text-white mb-4">Redirecting...</h1>
            <p class="text-gray-400">Please wait while we redirect you to the video.</p>
            <div class="mt-6">
                <svg class="animate-spin h-8 w-8 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </div>
            <p class="text-gray-500 text-sm mt-6">
                If you are not redirected automatically, <a id="redirect-link" href="#" class="text-blue-400 hover:underline">click here</a>.
            </p>
         </div>
    </div>
    
    <script>
        // This script handles the UI logic.
        // It runs after the redirect script at the top.
        const urlParams = new URLSearchParams(window.location.search);
        const tweetUrl = urlParams.get('tweet');

        if (tweetUrl) {
            // If a tweet URL is present, we're on a redirect page.
            // Hide the generator and show the redirect message for human visitors.
            document.getElementById('generator-ui').style.display = 'none';
            const redirectUI = document.getElementById('redirect-ui');
            redirectUI.style.display = 'block';

            const twitterRegex = /^(https?:\/\/)(www\.)?(twitter\.com|x\.com)(\/.+)/;
            if (twitterRegex.test(tweetUrl)) {
                const embedUrl = tweetUrl.replace(twitterRegex, '$1vxtwitter.com$4');
                document.getElementById('redirect-link').href = embedUrl;
            }

        } else {
            // Otherwise, we're on the main generator page.
            const generateBtn = document.getElementById('generate-btn');
            const twitterLinkInput = document.getElementById('twitter-link');
            const outputSection = document.getElementById('output-section');
            const outputLinkInput = document.getElementById('output-link');
            const copyBtn = document.getElementById('copy-btn');
            const copyBtnText = document.getElementById('copy-btn-text');
            const errorMessage = document.getElementById('error-message');
            const successOutput = document.getElementById('success-output');

            const generateLink = () => {
                const originalUrl = twitterLinkInput.value.trim();
                const twitterRegex = /^(https?:\/\/)(www\.)?(twitter\.com|x\.com)(\/.+)/;
                
                if (!twitterRegex.test(originalUrl)) {
                    errorMessage.textContent = 'Please enter a valid Twitter or X link.';
                    errorMessage.classList.remove('hidden');
                    successOutput.classList.add('hidden');
                } else {
                    // Generate a link to THIS site, with the tweet URL as a parameter.
                    const newUrl = `${window.location.origin}${window.location.pathname}?tweet=${encodeURIComponent(originalUrl)}`;
                    outputLinkInput.value = newUrl;
                    
                    errorMessage.classList.add('hidden');
                    successOutput.classList.remove('hidden');
                }
                
                // Show the output section.
                outputSection.classList.remove('hidden');
                setTimeout(() => {
                    outputSection.classList.remove('opacity-0', 'transform', '-translate-y-2');
                }, 10);
            };

            const copyLink = () => {
                outputLinkInput.select();
                document.execCommand('copy');
                copyBtnText.textContent = 'Copied!';
                copyBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                copyBtn.classList.add('bg-indigo-600');
                setTimeout(() => {
                    copyBtnText.textContent = 'Copy';
                    copyBtn.classList.add('bg-green-600', 'hover:bg-green-700');
                    copyBtn.classList.remove('bg-indigo-600');
                }, 2000);
            };
            
            generateBtn.addEventListener('click', generateLink);
            copyBtn.addEventListener('click', copyLink);
            
            twitterLinkInput.addEventListener('keydown', (event) => {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    generateLink();
                }
            });
        }
    </script>

</body>
</html>

